<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { api } from '../api'
import { useRouter } from 'vue-router'
import { useUserStore } from '../stores/userStore'

const router = useRouter()
const userStore = useUserStore()

const error = ref<Error>()
const loading = ref(true)
const success = ref(false)

const username = ref('')
const password = ref('')

async function login(){
    try {
        loading.value = true
        error.value = undefined

        const { data } = await api.post('/login', {
            username: username.value,
            password: password.value
        })

        const user = data.data.user
        const jwt = data.data.jwt

        userStore.authenticated(user, jwt)
        
        router.push('/')

    } catch (e){
        error.value = e as Error
    } finally {
        loading.value = false
    }
};

</script>

<template>
    <div id="form-page-container">
    
        <div id="login-content">

            <div id="logo">
                <svg id="camada_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 318.29 177">
  <g>
    <path d="M78.91,81.76c-3.07-1.27-5.93-2.94-8.57-5l-.94-6.12c-.1-.53,0-.97.29-1.33s.66-.55,1.12-.58c.46-.02.9.16,1.33.54,3.36,3.12,6.94,5.64,10.73,7.56,3.79,1.92,7.27,2.88,10.44,2.88,2.3,0,4.1-.54,5.4-1.62s1.94-2.56,1.94-4.43c0-1.73-.53-3.31-1.58-4.75-1.06-1.44-2.47-2.81-4.25-4.1-1.78-1.3-4.44-3.07-7.99-5.33-3.84-2.5-6.83-4.69-8.96-6.59-2.14-1.9-3.65-3.65-4.54-5.26s-1.33-3.32-1.33-5.15.53-3.64,1.58-5.29c1.06-1.66,2.66-3.01,4.82-4.07,2.16-1.06,4.85-1.58,8.06-1.58,2.3,0,4.63.3,6.98.9,2.35.6,4.58,1.43,6.7,2.48l.86,5.69c.1.53.01.97-.25,1.33s-.62.55-1.08.58c-.46.02-.88-.13-1.26-.47-2.88-2.26-5.92-4.1-9.11-5.54-3.19-1.44-5.94-2.16-8.24-2.16-1.87,0-3.36.44-4.46,1.33s-1.66,2.05-1.66,3.49c0,1.82,1.09,3.82,3.28,5.98,2.18,2.16,5.58,4.66,10.19,7.49,3.79,2.35,6.74,4.45,8.86,6.3,2.11,1.85,3.6,3.61,4.46,5.29s1.3,3.53,1.3,5.54c0,2.69-.59,5.09-1.76,7.2-1.18,2.11-2.87,3.76-5.08,4.93-2.21,1.18-4.82,1.76-7.85,1.76-3.22,0-6.36-.64-9.43-1.91h0Z" style="fill: #fffaf0;"/>
    <path d="M111.17,81.15c-1.2-1.68-1.78-4.37-1.73-8.06l.07-25.06h-3.17v-.94l8.93-9.72v9h14.4v1.66h-14.4v27.58c0,2.5.18,4.21.54,5.15.36.94.92,1.4,1.69,1.4,1.06,0,2.36-.77,3.92-2.3,1.56-1.54,3.18-3.65,4.86-6.34.24-.43.58-.7,1.01-.79.43-.1.82,0,1.15.29.34.29.5.7.5,1.22v5.54c-1.68,1.01-3.67,1.91-5.98,2.7-2.3.79-4.42,1.19-6.34,1.19-2.45,0-4.27-.84-5.47-2.52h.02Z" style="fill: #fffaf0;"/>
    <path d="M138.24,80.28c-1.92-2.26-2.88-5.83-2.88-10.73v-23.18h5.9v23.54c0,3.5.61,6.02,1.84,7.56,1.22,1.54,2.92,2.3,5.08,2.3,1.73,0,3.53-.56,5.4-1.69s4.01-2.96,6.41-5.51v1.44c-2.5,3.17-4.96,5.56-7.38,7.16-2.42,1.61-4.84,2.41-7.24,2.41-2.83.05-5.21-1.06-7.13-3.31h0ZM145.66,42.27l6.55-9.58,3.53-.07c.62,0,1.09.19,1.4.58.31.38.43.82.36,1.3-.07.48-.4.89-.97,1.22-3.26,1.92-6.55,4.2-9.86,6.84,0,0-1.01-.29-1.01-.29ZM158.9,73.66v-27.29h5.9v26.35l1.58,10.08h-5.9l-1.58-9.14h0Z" style="fill: #fffaf0;"/>
    <path d="M179.14,81.29c-2.16-1.49-3.85-3.53-5.08-6.12-1.22-2.59-1.84-5.52-1.84-8.78-.05-3.79.66-7.28,2.12-10.48,1.46-3.19,3.46-5.72,5.98-7.6,2.52-1.87,5.22-2.81,8.1-2.81,1.63,0,3.22.3,4.75.9,1.54.6,2.92,1.57,4.14,2.92,1.22,1.34,2.12,3.1,2.7,5.26l-1.08.79v-22.46l5.83-.94v41.11l1.58,9.72h-5.83l-1.58-8.28v-10.51c0-2.93-.56-5.65-1.69-8.17s-2.64-4.52-4.54-6.01c-1.9-1.49-3.95-2.23-6.16-2.23-2.78,0-4.97,1.27-6.55,3.82-1.58,2.54-2.38,5.71-2.38,9.5.05,2.88.52,5.77,1.4,8.68.89,2.9,2.24,5.34,4.07,7.31,1.82,1.97,4.06,2.95,6.7,2.95,1.63,0,3.23-.46,4.79-1.37,1.56-.91,3.11-2.52,4.64-4.82l.29,1.37c-1.68,2.83-3.65,4.96-5.9,6.37-2.26,1.42-4.63,2.12-7.13,2.12-2.74,0-5.18-.74-7.34-2.23h.01Z" style="fill: #fffaf0;"/>
    <path d="M215.06,39.17c-.67-.58-.98-1.32-.94-2.23,0-.96.34-1.76,1.01-2.41.67-.65,1.54-.97,2.59-.97s1.84.29,2.48.86c.65.58.97,1.34.97,2.3s-.35,1.69-1.04,2.34c-.7.65-1.57.97-2.63.97-.96,0-1.78-.29-2.45-.86h.01ZM214.7,46.37h5.83v36.43h-5.83v-36.43h0Z" style="fill: #fffaf0;"/>
    <path d="M235.76,81.33c-2.57-1.56-4.57-3.71-6.01-6.44s-2.16-5.81-2.16-9.22c0-3.65.82-7.01,2.45-10.08,1.63-3.07,3.85-5.52,6.66-7.34,2.81-1.82,5.92-2.74,9.32-2.74,3.12,0,5.94.78,8.46,2.34s4.5,3.74,5.94,6.55,2.16,6.01,2.16,9.61-.78,7.04-2.34,10.04-3.71,5.35-6.44,7.06c-2.74,1.7-5.81,2.56-9.22,2.56s-6.25-.78-8.82-2.34h0ZM253.98,79.28c1.46-.96,2.59-2.29,3.38-4,.79-1.7,1.19-3.61,1.19-5.72,0-3.12-.82-6.31-2.45-9.58-1.63-3.26-3.77-5.96-6.41-8.1s-5.35-3.2-8.14-3.2c-1.92,0-3.61.48-5.08,1.44-1.46.96-2.6,2.28-3.42,3.96-.82,1.68-1.22,3.6-1.22,5.76,0,3.17.83,6.38,2.48,9.65,1.66,3.26,3.8,5.95,6.44,8.06s5.38,3.17,8.21,3.17c1.87,0,3.54-.48,5-1.44h.02Z" style="fill: #fffaf0;"/>
  </g>
  <g>
    <path d="M74.54,137.39c-3.53-2.16-6.28-5.12-8.24-8.89-1.97-3.77-2.95-8-2.95-12.71,0-4.99,1.13-9.58,3.38-13.75,2.26-4.18,5.32-7.48,9.18-9.9,3.86-2.42,8.17-3.64,12.92-3.64,2.69,0,5.3.4,7.85,1.19,2.54.79,4.66,1.86,6.34,3.2l1.01,6.41c.1.62-.02,1.15-.36,1.58-.34.43-.76.64-1.26.61-.5-.02-.97-.25-1.4-.68-2.74-2.98-5.56-5.21-8.46-6.7-2.9-1.49-5.82-2.23-8.75-2.23-3.17,0-5.96.8-8.39,2.41-2.42,1.61-4.3,3.79-5.62,6.55-1.32,2.76-1.98,5.89-1.98,9.4,0,4.32.95,8.4,2.84,12.24,1.9,3.84,4.55,6.92,7.96,9.25s7.32,3.49,11.74,3.49c2.59-.05,5.11-.49,7.56-1.33s4.63-2.08,6.55-3.71l.79.79c-2.4,3.02-5.11,5.39-8.14,7.09s-6.55,2.56-10.58,2.56c-4.46,0-8.46-1.08-11.99-3.24h0Z" style="fill: #fffaf0;"/>
    <path d="M110.43,138.03c-1.68-1.63-2.52-3.67-2.52-6.12,0-1.82.56-3.49,1.69-5,1.13-1.51,2.59-2.87,4.39-4.07s4.12-2.5,6.95-3.89l2.23-1.08,8.86-4.18v1.66l-9.36,4.46c-2.54,1.2-4.67,2.57-6.37,4.1-1.7,1.54-2.56,3.36-2.56,5.47,0,1.82.67,3.37,2.02,4.64,1.34,1.27,3.12,1.91,5.33,1.91,1.92,0,3.76-.51,5.51-1.55,1.75-1.03,3.23-2.39,4.43-4.07l.65.72c-1.78,2.78-3.82,5.05-6.12,6.8s-5.02,2.63-8.14,2.63-5.3-.82-6.98-2.45v.02ZM130.59,131.41v-18.43c0-2.93-.31-5.17-.94-6.73-.62-1.56-1.78-2.34-3.46-2.34-1.39,0-3.14.7-5.26,2.09-2.11,1.39-4.39,3.46-6.84,6.19-.43.48-.91.73-1.44.76-.53.02-.95-.18-1.26-.61-.31-.43-.42-.96-.32-1.58l.79-4.75c1.73-.86,3.91-1.67,6.55-2.41s4.97-1.12,6.98-1.12c3.74,0,6.54,1.15,8.39,3.46,1.85,2.3,2.77,5.81,2.77,10.51l-.07,14.18,1.66,9.14h-5.98l-1.58-8.35h.01Z" style="fill: #fffaf0;"/>
    <path d="M150.24,139.3c-2.4-.89-4.49-1.93-6.26-3.13l-.86-5.18c-.05-.53.05-.96.29-1.3.24-.33.58-.52,1.01-.54.43-.02.84.13,1.22.47,2.54,2.26,5.33,4.14,8.35,5.65,3.02,1.51,5.69,2.27,7.99,2.27,1.58,0,2.88-.38,3.89-1.15s1.51-1.8,1.51-3.1c0-1.05-.38-2.05-1.15-2.99-.77-.94-1.96-1.94-3.56-3.02-1.61-1.08-3.92-2.48-6.95-4.21-2.5-1.44-4.5-2.69-6.01-3.74-1.51-1.06-2.74-2.26-3.67-3.6-.94-1.34-1.4-2.88-1.4-4.61,0-2.5,1.02-4.56,3.06-6.19s4.91-2.45,8.6-2.45c3.17,0,6.65.67,10.44,2.02l.65,4.32c.1.67.02,1.2-.22,1.58-.24.38-.6.58-1.08.58s-.96-.19-1.44-.58c-2.16-1.68-4.3-3.06-6.41-4.14-2.11-1.08-4.03-1.62-5.76-1.62-1.49,0-2.68.34-3.56,1.01-.89.67-1.33,1.54-1.33,2.59,0,1.54.89,3.02,2.66,4.46,1.78,1.44,4.27,3.02,7.49,4.75,4.22,2.3,7.24,4.43,9.04,6.37,1.8,1.94,2.7,4.21,2.7,6.8,0,3.02-1.03,5.45-3.1,7.27-2.06,1.82-4.92,2.74-8.57,2.74-2.64,0-5.16-.44-7.56-1.33h0Z" style="fill: #fffaf0;"/>
    <path d="M178.61,137.24c-1.92-2.25-2.88-5.83-2.88-10.73v-23.18h5.9v23.54c0,3.5.61,6.02,1.84,7.56,1.22,1.54,2.92,2.3,5.08,2.3,1.73,0,3.53-.56,5.4-1.69s4.01-2.96,6.41-5.51v1.44c-2.5,3.17-4.96,5.56-7.38,7.16-2.42,1.61-4.84,2.41-7.24,2.41-2.83.05-5.21-1.06-7.13-3.31h0ZM199.27,130.62v-27.29h5.9v26.35l1.58,10.08h-5.9l-1.58-9.14h0Z" style="fill: #fffaf0;"/>
    <path d="M215.33,89.87l5.83-1.01v50.9h-5.83v-49.9h0Z" style="fill: #fffaf0;"/>
    <path d="M236.53,138.29c-2.57-1.56-4.57-3.71-6.01-6.44-1.44-2.74-2.16-5.81-2.16-9.22,0-3.65.82-7.01,2.45-10.08,1.63-3.07,3.85-5.52,6.66-7.34s5.92-2.74,9.32-2.74c3.12,0,5.94.78,8.46,2.34s4.5,3.74,5.94,6.55,2.16,6.01,2.16,9.61-.78,7.04-2.34,10.04-3.71,5.35-6.44,7.06c-2.74,1.7-5.81,2.56-9.22,2.56s-6.25-.78-8.82-2.34h0ZM254.75,136.24c1.46-.96,2.59-2.29,3.38-4,.79-1.7,1.19-3.61,1.19-5.72,0-3.12-.82-6.31-2.45-9.58-1.63-3.26-3.77-5.96-6.41-8.1s-5.35-3.2-8.14-3.2c-1.92,0-3.61.48-5.08,1.44-1.46.96-2.6,2.28-3.42,3.96-.82,1.68-1.22,3.6-1.22,5.76,0,3.17.83,6.38,2.48,9.65,1.66,3.26,3.8,5.95,6.44,8.06s5.38,3.17,8.21,3.17c1.87,0,3.54-.48,5-1.44h.02Z" style="fill: #fffaf0;"/>
  </g>
</svg>
            </div>

            <div id="form container">
                <form id="login-form" @submit.prevent="login">
                    <h2>Entrar na minha conta</h2>
                    <span>Não tem uma conta? <a v-bind:href="`/register`">Criar uma conta</a></span><br/>
                    <label for="username">Nome de usuário:</label><br/>
                    <input type="text" id="username" name="username" v-model="username" required><br/>
                    <label for="password">Senha:</label><br/>
                    <input type="password" id="password" name="password" v-model="password" required><br>
                    <!-- <a>Esqueci minha senha</a><br/> -->

                    <div v-if="error">
                        {{ error }}
                    </div>

                    <input type="submit" value="Entrar">
                </form>
            </div>

        </div>

    </div>
</template>

<style scoped>
#camada_2{
    margin-left: 350px;
    width: 21%;
    height: 100%;
    background-color: var(--dark-color);
    position: absolute;
    top: 0;
    left: 0;
}
#form-page-container {
    width: 100%;
    height: 100%;
}

#login-content {
    width: 100%;
    height: calc(100vh - 80px);
    box-sizing: border-box;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
}

#login-form {
    margin-left: 350px;
    width: 25vw;
    box-sizing: border-box;
    background-color: var(--light-color);
    padding: 2em;
    border-radius: 20px;
    display: flex;
    flex-direction: column;
}

#login-form h2 {
    font-weight: bold;
}

#login-form p {
    font-size: 0.9em;
    color: #1E1E1E;

    margin-bottom: 1em;
}

#login-form span{
    font-size: 0.9em;
    color: #1E1E1E;
    margin-bottom: 1em;
}

#login-form span a{
    font-weight: 700;
}



#login-form label{
    box-sizing: border-box;
    font-weight: 600;
    font-size: 1.1em;
}

#login-form input[type="text"],input[type="email"], #login-form input[type="password"] {
    box-sizing: border-box;
    padding: 12px;
    margin-bottom: 20px;
    background-color: #FFFAF0;
    border: 2px solid var(--dark-color);
    border-radius: 10px;
    font-size: 1em;
}


#login-form input[type="submit"] {
    box-sizing: border-box;
    background-color: var(--dark-color);
    color: white;
    font-size: 1rem;
    font-weight: 600;
    padding: 10px 20px;
    margin-top: 20px;
    border: none;
    border-radius: 10px;
    margin-left: auto;
    cursor: pointer;
}
</style>